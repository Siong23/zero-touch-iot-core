FROM python:3.9-slim

# Install system dependencies and Coral Edge TPU runtime
RUN apt-get update && apt-get install -y \
    wget gnupg python3-pip python3-dev python3-opencv \
    && echo "deb https://packages.cloud.google.com/apt coral-edgetpu-stable main" \
       > /etc/apt/sources.list.d/coral-edgetpu.list \
    && wget https://packages.cloud.google.com/apt/doc/apt-key.gpg \
    && apt-key add apt-key.gpg \
    && apt-get update && apt-get install -y libedgetpu1-std \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Install pycoral from Coral's repo
RUN pip install --no-cache-dir --extra-index-url https://google-coral.github.io/py-repo/ pycoral

# Copy requirements.txt from detect_app folder
COPY detect_app/requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

# Copy your application code
COPY detect_app/ .

# Copy model files from all_models directory (outside detect_app)
COPY all_models/ ./all_models/

CMD ["python", "detect.py"]

